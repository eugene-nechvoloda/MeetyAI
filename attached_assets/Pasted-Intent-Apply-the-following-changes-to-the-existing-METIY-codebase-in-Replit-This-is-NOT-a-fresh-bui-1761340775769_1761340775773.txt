Intent
Apply the following changes to the existing METIY codebase in Replit. This is NOT a fresh build. Convert METIY into a backend-only service with Slack as the sole UI. All user interactions (upload/paste/link, pipeline status, approvals, exports, settings) happen inside the Slack app via DMs, message shortcuts, slash commands, modals, and the App Home. Keep zero-click pipeline and deep analysis. Preserve existing integrations and data. No web frontend.

Technical Configuration

Model: Claude Sonnet 4.5 (primary), fallbacks: Claude Opus 4.1 or ChatGPT-5
Temperature: 0.35 (0.3–0.5 acceptable)
Research Depth: 0.7 (deep multi-pass extraction)
Notifications: Slack-only (no email)
Scheduler: hourly Zoom polling remains; do not surface “next run” visuals in Slack per requirement
Scope of Changes (Delta)
A) Replace web UI with Slack-only UI

Remove or disable the web frontend routes and assets. Keep backend, jobs, DB, and integrations.
All human interactions occur in Slack (DMs with the bot, message shortcuts, slash commands, and App Home).
B) Slack App UX (zero-click pipeline in Slack)

Inputs accepted in Slack:
File uploads: TXT/PDF transcripts; optionally media files for Whisper; respect Slack file size/retention limits.
Raw text: pasted into a DM with the bot or via /meti paste "…"
Link to transcript in cloud: public URL; if private, respond with actionable error and suggest secure upload.
Link to video: public link; download audio and transcribe if permissible; otherwise return guidance.
Scheduled imports: hourly Zoom check via Zoom API (auto-ingest and process).
Zero-click: upon receiving any of the above, immediately run ingest → transcribe/translate (if needed) → analyze → post insights.
Results delivery: post to the user via DM from the Slack app/bot. Thread replies for progress; final insights appear in the same DM.
C) Slack Interaction Model

Commands:
/meti help
/meti paste "<text>" (ingests raw text)
/meti insights [transcript_id] (fetch list for a prior run)
/meti export [transcript_id] [all|selected] (open export modal if selected)
Message/file shortcut:
“Send to METIY” (on any message or file) → ingest immediately
Quick actions in chat (Block Kit buttons):
Approve all, Export all, Export selected (opens modal with multi-select)
App Home:
Landing with quick upload guidance and action buttons:
Upload file (opens file prompt)
Paste text (opens modal with textarea)
Submit link (opens modal for URL)
Settings entry points (Import, Models, Export, Knowledge Base)
D) Pipeline Status Updates in Slack

In the DM thread created for the item:
Post one progress message and update it via chat.update for major steps:
“Extracting transcript…”
“Translating to English…”
“Analyzing (pass 1/4)… (2/4)… (3/4)… (4/4)…”
“Compiling insights…”
“Done — N insights ready.”
For long jobs, post periodic “still working…” updates every ~60–90s to satisfy Slack user feedback.
On completion:
Post a Block Kit message containing:
Summary (N insights, types distribution)
Paginated list (first page) with checkboxes for “Export selected”
Buttons: Approve all, Export all, Open selection (modal)
E) Insight Review and Export in Slack

Insights appear in DM as interactive blocks:
Each insight shows: title, type, confidence, timestamp; “View evidence” opens a modal with verbatim quote(s).
Approve toggles state server-side; Export selected triggers a modal with multi-select list.
Export destinations: Airtable and Linear (Jira later). Mapping is configured in Slack Settings (Export tab).
Filters for export (optional): confidence threshold, types; applied if configured in Export settings.
Slack-only notifications: on analysis completion and on any failure (posted in DM). No email.
F) Settings in Slack (replacing web Settings)
Move the following settings to Slack App Home, each as a “Manage” button that opens a configuration modal. Mark these as NEW in the UI on first release.

Import (NEW)
Purpose: Configure external sources and enable hourly polling.
Modal fields:
Provider: Zoom, Google Meet (with limitation note), Fireflies, Custom API
Connection:
Zoom: “Connect Zoom” (OAuth flow)
Fireflies: API Key
Custom API: base URL + bearer/header
Optional filters: lookback days, team/account, include-only status
Schedule: cron (default hourly “0 * * * *”)
Enabled toggle
Test Connection, Save, Run Now
Visuals: Per instruction, skip “next run” displays (no next_run badges). Keep only discreet success/error confirmations.
Models (NEW)
Purpose: Choose providers/models and store API keys to use user’s own accounts.
Modal sections:
Add provider key: provider (OpenAI/ChatGPT, Anthropic/Claude, optional Groq/Ollama), label, API key (secret)
Test Connection button per provider
Defaults:
Analysis model (e.g., Anthropic — Claude 3.5 Sonnet)
Embeddings model (e.g., OpenAI — text-embedding-3-large)
Whisper on/off for audio/video transcription
Security: keys stored server-side encrypted; never echoed back; show only last 4 chars.
Export (NEW)
Purpose: Connect Airtable/Linear and map fields for exports; optional filters.
Modal:
Provider: Airtable, Linear (Jira later)
Auth fields (Airtable: API key + Base ID + Tables; Linear: API key + Team ID)
Field mapping: local fields → provider fields; presets and overrides
Optional filters: types, min confidence, exclude duplicates
Test Mapping and Save
Knowledge Base (NEW)
Purpose: Add multiple knowledge sources to enrich analysis.
Modal:
Add source: Helpdesk (URL + auth), Website (URL), File upload/cloud link
Toggle “Use in analysis”
Actions: Index Now, Remove, Reindex
Indexing: extract → chunk → embed → Pinecone namespace “kb”; store source metadata.
G) Backend/API Changes (augment, don’t break)

Slack endpoints:
POST /slack/events (Events API: app_mention, message.im, file_shared, link_shared)
POST /slack/commands (slash commands)
POST /slack/interactivity (block actions, modals)
Existing pipeline endpoints remain internal. Link Slack actions to:
Create transcript record with title rules by origin; enqueue pipeline
Approve insights; Export selected/all with chosen mapping
Title derivation (unchanged rules):
File: exact filename.ext
Paste: first sentence (<=120 chars), fallback “Pasted transcript — {timestamp}”
Link: domain — slug TitleCase (use quick metadata if feasible)
Scheduler:
Hourly Zoom poll remains; do not display “next run”. Upon discovering new items, auto-ingest and DM user with standard pipeline progress/results.
H) Data Model (Prisma — additive)

transcripts: add slack_user_id, slack_channel_id, slack_message_ts (for updates), origin fields already present
transcript_activity: keep for internal logs; Slack uses message updates instead of SSE
settings_models, export_configs, knowledge_sources, import_sources: unchanged from prior versions, now managed via Slack modals
insights: status [generated, exported, archived, failed] unchanged
I) Slack Scopes and App Config

Required bot scopes:
commands, chat:write, chat:write.public (if posting to channels), app_mentions:read, im:history, im:write
files:read (to download user-uploaded files)
users:read
links:read (for link_shared), links:write (optional unfurl control)
app_home:read, app_home:write
channels:read (only if posting in channels; optional since we use DMs)
reactions:write (optional UX feedback)
workflows:trigger (optional)
Interactivity: enable and point to /slack/interactivity
Events (subscribe):
app_mention, message.im, file_shared, link_shared, app_home_opened
J) Research Depth Configuration
Current Research Depth: 0.7 (Deep Dive)

Perform 4-pass extraction:
Pass 1: pains/blockers
Pass 2: features/ideas
Pass 3: gains/outcomes
Pass 4: objections/buying signals
Evidence-first: verbatim quotes with timestamps if available; no invented text
Extract 10+ candidate quotes/hour when supported; cross-reference across passes
Duplicates: do not dedupe; mark duplicate_flag when cosine similarity > 0.92
Confidence score: based on clarity, repetition, corroboration
K) Anti-Hallucination Protocol

Never fabricate quotes, timestamps, participants, titles, or user metadata
Private/forbidden links: respond with precise reason and suggest secure upload; do not claim success
If video download/transcription is restricted, state limitations and ask for an alternate source
For model/provider/KB connections: do not mark “connected” unless live test passes
When information not found/unclear/conflicts: state explicitly in Slack DM; proceed only with what’s verifiable
L) Quality Control & Self-Verification

Before posting insights in Slack:
Evidence is verbatim and found in transcript
Title 50–70 chars; Description ≤200 chars; Type within enum
All 4 passes ran (Depth 0.7); duplicates flagged
Before export:
Validate mapping; dry-run payload shape; handle errors with retries and post clear failure messages in DM
Rate limiting:
Coalesce progress updates to avoid Slack rate limits; prefer chat.update over many new messages
Security:
Keys never echoed in Slack; redact secrets; store encrypted server-side
M) Acceptance Criteria

DM-based zero-click flow:
When user uploads file/pastes text/sends link to the bot, bot DMs (or uses same DM) progress messages and, upon completion, a paginated interactive list of insights with Approve/Export controls. No extra clicks needed to start.
Commands and shortcuts:
/meti paste works; “Send to METIY” shortcut on a message or file triggers ingest; /meti export opens export modal when “selected” option is used.
Approve/export:
“Approve all” and “Export all” buttons work; “Export selected” opens modal with checkboxes; export success/failure is reported in DM.
Settings in Slack:
App Home includes Manage buttons for Import, Models, Export, Knowledge Base. Each opens functioning modals that save to DB and perform real Test actions.
Scheduler:
Hourly Zoom polling runs; no “next run” visuals shown; on finds, pipeline runs and DM updates/results are posted.
No regressions:
Titles by origin rules apply
Transcript statuses internally remain [file_uploaded, transcribing, transcribed, failed]
Insights auto-generate; export mappings respected
N) Deliverables (Modify/Produce)

Remove/disable web frontend; keep health check endpoint
Slack app endpoints: /slack/events, /slack/commands, /slack/interactivity with signature verification
Block Kit builders for:
Progress updates (single message with chat.update)
Insights list (paginated) with Approve, Export buttons
Export selected modal (multi-select with preview)
Settings modals: Import, Models, Export, Knowledge Base
Title derivation utility (unchanged) invoked on Slack ingestion
Provider clients (Zoom, Fireflies, Airtable, Linear) wired to Slack flows
Tests:
Slack signature verification
Block action payload handling (approve/export)
Model keys test endpoints
Export mapping dry-run
Zoom hourly importer triggers DM flows
Notes

Respect Slack message length limits: paginate insights (e.g., 10 per page) with “Next/Prev” buttons; “View evidence” opens a modal.
If evidence is long, collapse with “Show more” in modal to stay within block limits.
For media/video links, if platform TOS blocks programmatic download, respond with guidance for supported alternatives (Zoom recording, direct file)